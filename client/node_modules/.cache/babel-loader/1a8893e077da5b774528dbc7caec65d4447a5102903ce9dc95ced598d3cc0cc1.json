{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n      label: 0,\n      sent: function () {\n        if (t[0] & 1) throw t[1];\n        return t[1];\n      },\n      trys: [],\n      ops: []\n    },\n    f,\n    y,\n    t,\n    g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n    while (g && (g = 0, op[0] && (_ = 0)), _) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n        case 7:\n          op = _.ops.pop();\n          _.trys.pop();\n          continue;\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n            _.ops.push(op);\n            break;\n          }\n          if (t[2]) _.ops.pop();\n          _.trys.pop();\n          continue;\n      }\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.RequestController = void 0;\nvar Error_1 = require(\"../../Error\");\nvar AxiosRetry_1 = require(\"../AxiosRetry\");\nvar ApiRequestError_1 = require(\"./ApiRequestError\");\nvar Config_1 = require(\"../../Config\");\n/**\n * A controller responsible to handle all requests in Moralis,\n * compatible with browser, nodejJs and react-native\n */\nvar RequestController = /** @class */function () {\n  function RequestController(config, logger) {\n    this.config = config;\n    this.logger = logger;\n  }\n  RequestController.create = function (core) {\n    return new RequestController(core.config, core.logger);\n  };\n  RequestController.prototype.request = function (config) {\n    return __awaiter(this, void 0, void 0, function () {\n      var maxRetries, retryConfig, response, e_1, error;\n      var _this = this;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            this.logger.verbose('[RequestController] request started', {\n              url: config.url,\n              method: config.method,\n              body: config.data\n            });\n            maxRetries = this.config.get(Config_1.CoreConfig.maxRetries);\n            retryConfig = {\n              maxRetries: maxRetries,\n              allowedMethods: ['GET', 'OPTIONS'],\n              allowedResponseStatuses: [408, 413, 429, 500, 502, 503, 504],\n              beforeRetry: function (attempt, error) {\n                _this.logger.verbose('[RequestController] request retry', {\n                  url: config.url,\n                  method: config.method,\n                  body: config.data,\n                  error: error,\n                  attempt: attempt\n                });\n              }\n            };\n            _a.label = 1;\n          case 1:\n            _a.trys.push([1, 3,, 4]);\n            return [4 /*yield*/, AxiosRetry_1.AxiosRetry.request(retryConfig, __assign(__assign({}, config), {\n              timeout: 20000,\n              maxContentLength: Infinity,\n              maxBodyLength: Infinity\n            }))];\n          case 2:\n            response = _a.sent();\n            return [2 /*return*/, response.data];\n          case 3:\n            e_1 = _a.sent();\n            error = this.makeError(e_1);\n            this.logger.verbose('[RequestController] request error', {\n              url: config.url,\n              method: config.method,\n              body: config.data,\n              cause: error.cause,\n              name: error.name,\n              details: error.details\n            });\n            throw error;\n          case 4:\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n\n  RequestController.prototype.makeError = function (error) {\n    if ((0, ApiRequestError_1.isApiRequestError)(error)) {\n      var _a = error.response,\n        status = _a.status,\n        statusText = _a.statusText;\n      var apiMessage = (0, ApiRequestError_1.getMessageFromApiRequestError)(error);\n      return new Error_1.CoreError({\n        code: Error_1.CoreErrorCode.REQUEST_ERROR,\n        message: \"Request failed, \".concat(statusText, \"(\").concat(status, \"): \").concat(apiMessage),\n        cause: error,\n        details: {\n          status: status,\n          response: error.response\n        }\n      });\n    }\n    var err = error instanceof Error ? error : new Error(\"\".concat(error));\n    return new Error_1.CoreError({\n      code: Error_1.CoreErrorCode.REQUEST_ERROR,\n      message: \"Request failed: \".concat(err.message),\n      cause: err\n    });\n  };\n  RequestController.prototype.post = function (url, searchParams, body, options, abortSignal) {\n    return this.request({\n      url: url,\n      params: searchParams,\n      method: 'POST',\n      data: body,\n      headers: options === null || options === void 0 ? void 0 : options.headers,\n      signal: abortSignal\n    });\n  };\n  RequestController.prototype.put = function (url, searchParams, body, options, abortSignal) {\n    return this.request({\n      url: url,\n      params: searchParams,\n      method: 'PUT',\n      data: body,\n      headers: options === null || options === void 0 ? void 0 : options.headers,\n      signal: abortSignal\n    });\n  };\n  RequestController.prototype.get = function (url, searchParams, options, abortSignal) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        return [2 /*return*/, this.request({\n          url: url,\n          params: searchParams,\n          method: 'GET',\n          headers: options === null || options === void 0 ? void 0 : options.headers,\n          signal: abortSignal\n        })];\n      });\n    });\n  };\n  RequestController.prototype.delete = function (url, searchParams, body, options, abortSignal) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        return [2 /*return*/, this.request({\n          url: url,\n          params: searchParams,\n          method: 'DELETE',\n          data: body,\n          headers: options === null || options === void 0 ? void 0 : options.headers,\n          signal: abortSignal\n        })];\n      });\n    });\n  };\n  return RequestController;\n}();\nexports.RequestController = RequestController;","map":{"version":3,"mappings":"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","names":["config","logger","RequestController","core","verbose","url","method","body","data","maxRetries","get","Config_1","retryConfig","allowedMethods","allowedResponseStatuses","beforeRetry","attempt","error","_this","AxiosRetry_1","request","timeout","maxContentLength","Infinity","maxBodyLength","response","_a","makeError","e_1","cause","name","details","status","statusText","apiMessage","Error_1","code","REQUEST_ERROR","message","err","Error","searchParams","options","abortSignal","params","headers","signal","exports"],"sources":["../../../src/controllers/RequestController/RequestController.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script","externalDependencies":[]}